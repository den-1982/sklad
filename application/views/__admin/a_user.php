<div class="body">			<!-- ALL USERS -->	<?php if ($act == 'all'):?>	<h1 class="title"><?=$h1?></h1>		<form id="users" action="" method="post">		<div class="nav">			<div class="fleft">				<select data-select="" name="limit">					<option value="30" selected>выводить по 30</option>					<option value="60">выводить по 60</option>					<option value="100">выводить по 100</option>						</select>								<select data-select="" name="sort">					<option value="0" <?=$sort == 0 ? 'selected' : '';?>>по общей сумме</option>					<option value="1" <?=$sort == 1 ? 'selected' : '';?>>по количеству заказов</option>					<option value="2" <?=$sort == 2 ? 'selected' : '';?>>по алфавиту</option>						</select>				<button data-button="" type="submit">Применить</button>			</div>			<div class="fright">				<a class="button green" href="<?=$path?>?add">Добавить клиента</a>			</div>		</div>				<table class="table-1" data-scroll="head">			<thead>				<tr>					<td class="small">№</td>					<td class="small">Cart</td>					<td class="">ФИО</td>					<td class="small nowrap">Общая сумма покупок</td>					<td class="small nowrap">Скидка %</td>					<td class="small nowrap">e-mail</td>					<td class="small">Телефон</td>					<td class="small"></td>					<td class="small"></td>					<td class="small"></td>				</tr>			</thead>			<thead>				<tr>					<td></td>					<td>						<input class="inf" data-search-input="cart" name="cart" type="text" value="">					</td>					<td>						<input class="inf" data-search-input="name" name="name" type="text" value="">					</td>					<td></td>					<td></td>					<td>						<input class="inf" data-search-input="email" name="email" type="text" value="">					</td>					<td>						<input class="inf" data-search-input="phone" name="phone" data-mask="_phone" type="text" value="">					</td>					<td></td>					<td></td>					<td></td>				</tr>			</thead>			<tbody id="box-users"></tbody>		</table>				<input type="hidden" name="get_users" value="">	</form>		<div class="pt-10">		<a id="append-users" class="button grey full" style="display:none;">+ добавить еще</a>	</div>		<?php endif;?>		<!-- USER -->	<?php if ($act == 'user'):?>		<h1 class="title"><?=$h1?></h1>		<div class="nav">		<div class="fleft">			<div class="crumbs">				<a href="<?=$path?>">Все клиенты</a>				:: <span><?=$user->name?></span>				:: <i class="c-orange"><a class="c-orange" href="/admin/user?edit=<?=$user->id?>">редактировать</a>  &rarr;</i>			</div>		</div>		<div class="fright"></div>	</div>		<div class="toggle-box">		<a class="bookmark-toggle activ" data-name="orders" href="#orders">Заказы</a>		<a class="bookmark-toggle" data-name="data" href="#data">Данные клиента</a>	</div>			<div class="bookmark activ" data-id="orders">		<table class="table-1">			<thead>				<tr>					<td class="small">№</td>					<td></td>					<td class="small">Дата</td>					<td class="small"></td>					<td class="small"></td>					<td class="small">Сумма</td>					<td class="small">Скидка</td>					<td class="small">Итого</td>					<td class="small">Статус</td>					<td class="small">						<a class="link_add" data-bind="add-order" href="/admin/orders/add/<?=$user->id?>" title="Создать заказ"></a>					</td>				</tr>			</thead>			<tbody>				<?php $total = 0; $i=1; foreach($user->orders as $k):?>				<tr>					<td><?=$i++?></td>										<td class="left">						<a href="/admin/orders/order/<?=$k->id?>" title="Смотреть заказ">Заказ № <?=$k->id?></a>						<span class="c-grey">&rarr; товаров(<?=$k->cnt_items?>)</span>					</td>					<td>						<b><?=date('d-m-Y  H:i', $k->date)?></b>					</td>					<td class="small">						<a class="button blue" data-order="<?=$k->id?>" href="javascript:void(0)" title="Смотреть заказ">...</a>					</td>					<td class="left nowrap">						<a href="/admin/orders/order/<?=$k->id?>">Смотреть заказ &rarr;</a>					</td>					<td class="left nowrap"><?=number_format($k->sum, 2, ",", "'")?> грн.</td>					<td><?=$k->discount*1?>%</td>					<td class="left nowrap">						<?php $k->sum = $k->discount ? round($k->sum - $k->sum * $k->discount / 100, 2, PHP_ROUND_HALF_UP) : $k->sum;?> 						<?=number_format($k->sum, 2, ",", "'")?> грн.					</td>					<td class="left">						<select data-select="" data-order-status="<?=$k->id?>" style="display:none;">							<option value="0" <?=$k->status == 0 ? 'selected' : '';?>>ПРИНЯТ</option>							<option value="1" <?=$k->status == 1 ? 'selected' : '';?>>ВЫПОЛНЕНО</option>						</select>					</td>					<td>						<a title="удалить заказ" class="link_del" data-delete="заказ: <?=date('d-m-Y  H:i', $k->date)?>" href="<?=$path?>?delete=<?=$k->id?>"></a>					</td>				</tr>				<?php $total += $k->sum; endforeach;?>			</tbody>			<tfoot>				<tr>					<td class="right" colspan="7">						<br><b>Общая СУММА:</b><br><br>					</td>					<td class="nowrap">						<b><?=number_format($total, 2, ",", "'")?> грн.</b>					</td>					<td></td>				</tr>			</tfoot>		</table>	</div>		<div class="bookmark" data-id="data">		<div class="nav">			<div class="fleft"></div>			<div class="fright">				<a class="button orange" href="/admin/user?edit=<?=$user->id?>" title="Редактировать клиента">Редактировать</a>			</div>		</div>		<table class="table-1">			<tr>				<td class="right small"><b>Имя:</b></td>				<td class="left"><?=$user->name?></td>			</tr>			<tr>				<td class="right small"><b>Email:</b></td>				<td class="left"><?=$user->email?></td>			</tr>			<tr>				<td class="right small"><b>Телефон:</b></td>				<td class="left"><?=$user->phone?></td>			</tr>			<tr>				<td class="right small"><b>Город:</b><br>"Новая-Почта"</td>				<td class="left"><?=$user->city?></td>			</tr>			<tr>				<td class="right small"><b>Отделение:</b><br>"Новая-Почта"</td>				<td class="left"><?=$user->office?></td>			</tr>			<tr>				<td class="right small nowrap"><b>Скидка:</b></td>				<td class="left"><?=$user->discount*1 ? ($user->discountName .' - '. (int)$user->discountPercent .'%') : '&mdash;'?></td>			</tr>			<tr>				<td class="right small nowrap"><b>Скидочная КАРТА</b></td>				<td class="left">					<?php if ($user->user_cart_discount):?>					"<?=$user->user_cart_discount?>" - <?=$user->user_cart_percent?>%					<?php else:?>					&mdash;					<?php endif;?>				</td>			</tr>		</table>	</div>	<?php endif;?>		<!--ADD USER -->		<?php if ($act == 'add'):?>	<h1 class="title"><?=$h1?></h1>		<div class="nav">		<div class="fleft"></div>		<div class="fright">			<a class="button blue" onclick="$('#form').submit()" >Сохранить</a>			<a class="button black" href="<?=$path?>?parent=<?=$parent?>">Отмена</a>		</div>	</div>		<form id="form" action="<?=$path?>" method="POST" enctype="multipart/form-data">				<div class="toggle-box">			<a class="bookmark-toggle activ" data-name="data" href="#data">Общие</a>		</div>				<div class="bookmark activ" data-id="data">			<table class="table-1">				<tr>					<td class="small right"><b>Ф.И.О.:</b></td>					<td class="left">						<input class="inf" type="text" name="name" value="">					</td>				</tr>				<tr>					<td class="right"><b>E-mail:</b></td>					<td class="left">						<input class="inf" type="text" name="email" value="">					</td>				</tr>				<tr>					<td class="right"><b>Телефон:</b></td>					<td class="left">						<input class="inf" data-mask="_phone" type="text" name="phone" value="">					</td>				</tr>				<tr>					<td class="right"><b>Скидка:</b></td>					<td class="left">						<select data-select="" name="discount">							<option value="0"> - Выбрать скидку - </option>							<?php foreach ($discounts as $item):?>							<option value="<?=$item->id?>"><?=$item->name.' - '.(int)$item->percent?>%</option>							<?php endforeach;?>						</select>					</td>				</tr>				<tr>					<td class="right nowrap"><b>Карта клиента:</b></td>					<td class="left">						<table class="table-1">							<thead>								<tr>									<td>Код карты</td>									<td>Скидка (%)</td>								</tr>							</thead>							<tbody>								<tr>									<td>										<input class="inf" data-mask="not-space" type="text" name="user_cart_discount" value="">									</td>									<td>										<input class="inf" data-mask="price" type="text" name="user_cart_percent" value="">									</td>								</tr>							</tbody>						</table>					</td>				</tr>				<tr>					<td class="right nowrap"><b>Новая Почта:</b></td>					<td class="left">						<table class="table-1">							<thead>								<tr>									<td class="small">Город</td>									<td class="small">Отделение</td>									<td class="small"></td>									<td>Карта</td>								</tr>							</thead>							<tbody>								<tr>									<td class="top">										<select id="city" data-select="" name="city_ref">											<option value="0" selected> - Выбрать город - </option>											<?php foreach ($cities['response'] as $city):?>											<option value="<?=$city->city_ref?>"><?=$city->cityRu?></option>											<?php endforeach;?>										</select>									</td>									<td class="top">										<select id="office" data-select="" name="ref">											<option value="0"> - Выбрать офис - </option>										</select>									</td>									<td class="top">										<a class="button blue" data-bind="yamap" href="javascript:void(0)">выбрать на карте</a>									</td>									<td class="left">										<img id="map-static" data-bind="yamap" src="" alt="image" title="Выбрать на карте">									</td>								</tr>							</tbody>						</table>					</td>				</tr>			</table>		</div>				<input type="hidden" name="add" value="">	</form>	<?php endif;?>	<!-- UPDATE USER -->	<?php if ($act == 'edit'):?>	<h1 class="title"><?=$h1?></h1>		<div class="nav">		<div class="fleft">			<div class="crumbs">				<a href="/admin/user">Все клиенты</a>				:: <a href="/admin/user/<?=$user->id?>"><?=$user->name?></a>				:: <span>редактирование</span>			</div>		</div>		<div class="fright">			<a class="button blue" onclick="$('#form').submit()" >Сохранить</a>			<a class="button black" href="/admin/user/<?=$user->id?>">Отмена</a>		</div>	</div>		<form id="form" action="<?=$path?>" method="POST" enctype="multipart/form-data">				<div class="toggle-box">			<a class="bookmark-toggle activ" data-name="data" href="#data">Общие</a>		</div>				<div class="bookmark activ" data-id="data">			<table class="table-1">				<tr>					<td class="small right"><b>Ф.И.О.:</b></td>					<td class="left">						<input class="inf" type="text" name="name" value="<?=htmlspecialchars($user->name)?>">					</td>				</tr>				<tr>					<td class="right"><b>E-mail:</b></td>					<td class="left">						<input class="inf" type="text" name="email" value="<?=htmlspecialchars($user->email)?>">					</td>				</tr>				<tr>					<td class="right"><b>Телефон:</b></td>					<td class="left">						<input class="inf" data-mask="_phone" type="text" name="phone" value="<?=$user->phone?>">					</td>				</tr>				<tr>					<td class="right"><b>Скидка:</b></td>					<td class="left">						<select data-select="" name="discount">							<option value="0"> - Выбрать скидку - </option>							<?php foreach ($discounts as $item):?>							<option value="<?=$item->id?>" <?=$item->id == $user->discount? ' selected' : '';?>><?=$item->name.' - '.(int)$item->percent?>%</option>							<?php endforeach;?>						</select>					</td>				</tr>				<tr>					<td class="right nowrap"><b>Карта клиента:</b></td>					<td class="left">						<table class="table-1">							<thead>								<tr>									<td>Код карты</td>									<td>Скидка (%)</td>								</tr>							</thead>							<tbody>								<tr>									<td>										<input class="inf" data-mask="not-space" type="text" name="user_cart_discount" value="<?=$user->user_cart_discount?>">									</td>									<td>										<input class="inf" data-mask="price" type="text" name="user_cart_percent" value="<?=$user->user_cart_percent?>">									</td>								</tr>							</tbody>						</table>					</td>				</tr>				<tr>					<td class="right nowrap"><b>Новая Почта:</b></td>					<td class="left">						<table class="table-1">							<thead>								<tr>									<td class="small">Город</td>									<td class="small">Отделение</td>									<td class="small"></td>									<td>Карта</td>								</tr>							</thead>							<tbody>								<tr>									<td class="top">										<select id="city" data-select="" name="city_ref">											<option value="0" selected> - Выбрать город - </option>											<?php foreach ($cities['response'] as $k):?>											<option value="<?=$k->city_ref?>" <?=$user->city_ref == $k->city_ref ? ' selected' : '';?>><?=$k->cityRu?></option>											<?php endforeach;?>										</select>									</td>									<td class="top">										<select id="office" data-select="" name="ref">											<option value="0" selected> - Выбрать офис - </option>											<?php if (isset($offices['response'][$user->city_ref])) foreach ($offices['response'][$user->city_ref] as $k):?>											<option value="<?=$k->ref?>" <?=$user->ref == $k->ref ? ' selected' : '';?> data-coordinates="[<?=$k->y?>,<?=$k->x?>]">												Отд. № <?=$k->number?> <?=$k->addressRu?>											</option>											<?php endforeach;?>										</select>									</td>									<td class="top">										<a class="button blue" data-bind="yamap" href="javascript:void(0)">выбрать на карте</a>									</td>									<td class="left">										<img id="map-static" data-bind="yamap" src="<?=$user->mapStatic?>" alt="image" title="Выбрать на карте">									</td>								</tr>							</tbody>						</table>					</td>				</tr>			</table>		</div>				<input type="hidden" name="id" value="<?=$user->id?>">		<input type="hidden" name="edit" value="">	</form>	<?php endif;?>	</div><!-- END BODY --><script> // APPLY$(document).on('click', '[data-form-apply]', function(e){	$(document.body).append($('<div class="load"></div>'));		if (tinyMCE && tinyMCE.editors){		$(tinyMCE.editors).each(function(){			$(this.getElement()).html(this.getContent());		});	}		AP.init('', $('#form')[0], function(){			location.reload(true);	});	return false;});</script><script> // SEARCH$(function(){	var start = 0;		// очисить все поля кроме нажатого	var inputs = $('[data-search-input]').on('keydown', function(e){		if (e.keyCode == 13){			inputs.filter(':not(:eq('+ inputs.index(this) +'))').val('');		}	});		$('#users').on('submit', function(e){		e.preventDefault();		getHtml($(this).serialize(), "html");	});		$('#append-users').on('click', function(e){		e.preventDefault();		getHtml($('#users').serialize()+'&start='+start, "append");	});			function getHtml(query, act){		var l = $('<div class="load"></div>').appendTo(document.body);				$.post('', query, function(data){			var html = $(data['users_html']);			html.find('[data-select]').selectmenu({width:'auto'});						start = data['start'];			$('#append-users')[(data['rest'] > 0 ? 'fadeIn' : 'fadeOut')](500);						$('#box-users')[act](html);			$('td:first', $('#box-users > tr')).each(function(a,b){				this.innerHTML = ++a;			});						$('[data-scroll="head"] > thead:first').scrollHead('refresh');						l.remove();		}, 'json');	}});</script><script> // NOVA-POSHTA$(function(){	var dialogMap,		offices,		map;			// getOffices();		var np = $('#city, #office, [data-bind="yamap"]');	np.filter('#city').on('selectmenuchange', changeCity);	np.filter('#office').on('selectmenuchange', changeOffice);	np.filter('[data-bind="yamap"]').on('click', _map);				function changeCity(e){		var city_ref = this.value;					getOffices(function(list){			var select = np.filter('#office');						select.html($('<option value="0" selected> - выбрать - </option>'));			if (list[city_ref]) $.each(list[city_ref], function(){				select.append(					$('<option>', {value:this.ref})						.data('coordinates', [this.y, this.x])						.data('cityRu', this.cityRu)						.html('Отд. № '+this.number+' - '+this.addressRu)				);			});			select.selectmenu('refresh');		});	}		function changeOffice(){		var cord = $(this).find(':selected').data().coordinates;		if (cord){			showMapStatic({x:cord[1], y:cord[0]});		}else{			showMapStatic();		}	}		// выбор отделения на карте	$(document).on('click', '[data-bind="change-office"]', changeOfficeMap);	function changeOfficeMap(){		dialogMap.dialog('close');		var data = $(this).data();				getOffices(function(list){			var city = np.filter('#city').find('option[value="'+data.city_ref+'"]');						// добавить город если нет в списки			if ( ! city.length){				np.filter('#city').append('<option value="'+data.city_ref+'">'+data.city_ru+'</option>');			}						np.filter('#city')				.find('option[value="'+data.city_ref+'"]')				.prop('selected', true)				.parent()				.selectmenu('refresh');									np.filter('#office')				.html($('<option value="0" selected> - выбрать - </option>'));			if (list[data.city_ref]) $.each(list[data.city_ref], function(){								if (this.ref == data.ref){					showMapStatic({x:this.x, y:this.y});				}								np.filter('#office').append(					$('<option>', {value:this.ref})						.data('coordinates', [this.y, this.x])						.data('cityRu', this.cityRu)						.html('Отд. № '+this.number+' - '+this.addressRu)						.prop('selected', (this.ref == data.ref ? true : false))				);			});			np.filter('#office').selectmenu('refresh');		});	}		function showMapStatic(cord){		if ( ! cord){			$('#map-static').css({display:'none'});			return;		}				$('#map-static').css({display:'none'}).load(function(){			$(this).fadeIn();		}).attr('src', 'http://static-maps.yandex.ru/1.x/?ll='+cord.x+','+cord.y+'&size=600,250&z=16&l=map&pt='+cord.x+','+cord.y+',pm2rdl&lang=ru_RU')	}		function _map(e){		dialogMap = $('<div id="yamap" style="height:100%;"></div>').dialog({			title:'Почтовые отделеня "НОВАЯ ПОЧТА"',			type:'map',			width:'100%',			height:'100%'		});				// координаты украины (по умолчанию)		var coord = [49.1782,31.5398],			zoom = 6,			ref = '';				// если уже выбран office		var refSelected = np.filter('#office').find(':selected');		if (refSelected.length && refSelected.data().coordinates){			coord = refSelected.data().coordinates;			zoom = 16;			ref = np.filter('#office').val();		}				getOffices(function(list){			YaApiMap(function(){								map = new ymaps.Map('yamap', {					center: coord,					zoom: zoom,					controls: ['typeSelector', 'zoomControl']				});				// запрещаем ZOOM, copyrights				map.behaviors.disable('scrollZoom');				$('[class $= "copyrights-pane"]').remove();								// кластер				map.clusterer = new ymaps.Clusterer({clusterDisableClickZoom: false, preset:'twirl#blueClusterIcons'});				$.each(list, function(){					$.each(this, function(){						var k = this;						if (!k.y || !k.x) return;												var str = 						'<div class="yamaps-baloon">'+							'<div class="city">'+k.cityRu+'</div>'+							'<div class="number">№'+k.number+' Отделение</div>'+							'<div class="adress">'+k.addressRu+'</span></div>'+							'<div class="phone">Клиентская поддержка: +38 '+k.phone+'</div>'+							'<div class="button-box">'+								'<a class="button blue" '+									'data-bind="change-office" '+									'data-city_ru="'+k.cityRu+'" '+									'data-city_ref="'+k.city_ref+'" '+									'data-ref="'+k.ref+'" '+									'href="javascript:void(0)">выбрать</a>'+							'</div>'+						'</div>';												var Placemark = new ymaps.GeoObject({							geometry: {								type: "Point", 								coordinates:[k.y, k.x]							},							properties: {								balloonContentBody: str,								iconContent: k.number,								hintContent: "Отделение № " + k.number							}						},						{							preset: (ref == k.ref ? 'islands#redStretchyIcon' : 'islands#greenStretchyIcon')						});						Placemark.events.add('click', function (e) {							//map.setCenter(Placemark.geometry.getCoordinates(),16,{checkZoomRange:true,duration:1000});							map.setCenter(Placemark.geometry.getCoordinates(), 16);						});						map.clusterer.add(Placemark);											});				});								map.geoObjects.add(map.clusterer);			});		});	}		function getOffices(callback){		callback = (typeof callback == 'function') ? callback : new Function; 				if (offices) return callback(offices);				$.post('/admin/novaposhta', {getOfficesNovaPoshta:''}, function(data){			offices = data['response'];			callback(offices);		}, 'json');	}	});</script><script> // DISCOUNT $(document).on("selectmenuchange", '[data-discount]', function(e, ui){	var l = $('<div class="load"></div>').appendTo(document.body);		var user = $(this).attr('data-discount');	var discount = $(this).find('option:selected').val();		$.post('', {setdiscount:'', id_discount:discount, id_user:user}, function(data){		l.remove();	});});</script><script> // STATUS ORDER$('[data-order-status]').on( "selectmenuchange", function(e, ui){	var l = $('<div class="load"></div>').appendTo(document.body);		var id_order = $(this).attr('data-order-status');	var status = $(this).find(':selected').val();		$.post('/admin/orders', {set_status_order:'', id_order:id_order, status:status}, function(data){		l.remove();	});});</script><script> // ORDERS (всплывающее окно с товарами заказа)$(document).on('click', '[data-order]', function(e){	e.preventDefault();		$.post('/admin/orders',{getorder:$(this).data('order')}, function(data){		var html = 		'<table class="table-1">'+			'<thead>'+				'<tr>'+					'<td class="small">№</td>'+					'<td class="small"></td>'+					'<td>название</td>'+					'<td class="small">размер</td>'+					'<td class="small">опт/роз</td>'+					'<td class="small">цена</td>'+					'<td class="small">кол.</td>'+					'<td class="small">сумма</td>'+				'</tr>'+			'</thead>'+			'<tbody>';					$.each(data.items, function(i){				html += 				'<tr>'+					'<td>'+(i+1)+'</td>'+					'<td>'+						'<a href="/admin/products?update='+this.product_id+'" target="_blank">'+							'<img width="50"  src="'+this.product_image+'" alt="">'+						'</a>'+					'</td>'+					'<td class="left">'+						'<a href="/admin/products?update='+this.product_id+'" target="_blank">'+this.product_name+'</a>'+					'</td>'+					'<td class="nowrap">'+ (this.filter_size_name) +' <small>('+ (this.filter_prefix) +')</small></td>'+					'<td class="nowrap">'+(+this.type ? 'опт.' : 'роз.')+'</td>'+					'<td class="nowrap">'+number_format(this.price, 2, ',', "'")+'</td>'+					'<td class="nowrap">'+(this.quantity)+'</td>'+					'<td class="nowrap">'+number_format(this.subtotal, 2, ',', "'")+'</td>'+				'</tr>';			});				html += 			'</tbody>'+		'</table>';				$(html).dialog({			height:'auto',			width:600,			drag: true,			title:'Заказ № '+data.id		});			}, 'json');	});</script>